language: cpp

sudo: required

dist: trusty

compiler:
    - gcc

install:
#    - sudo apt-get install -qq libgtest-dev
    - pushd /usr/src/gtest && sudo cmake CMakeLists.txt && sudo make && sudo cp *.a /usr/lib && popd

before_script:
    - export CC=gcc-6
    - export CXX=g++-6
    - mkdir build
    - cd build
    - cmake ..

script:
    - make
    - ctest --output-on-error

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "LPtyMNqhL6RfYnyf+BEL+wZIQc69LlJtlDg9WwiHvNyyk9sZSdNTIMAC1JUjW2v4cKfAkBKqUiR7/ABhaWzMPhhQPTSt0T2SjYyELOzHQsEQ6OQ9LjrCLKuitMcWaw89sdH71S+vbtSyAjyza6QI5ZKCpRdb1woRm0imvaWMSlsScMM0MXl+7jw+mgPBDCsJEsAZ4QOdG0uRFCR4R5K8cnx3dKVHzeMACI5GeHFZ834fA0Oyz85XQtp5N01Ms0muDcNG5YpNd4UtCaXcCAiQa3pKV86n04D/Cqbao+AhZPuJtjBSSRC4XV9oA6+0HRBmeHMv0ywNThHcX0+EvL/8i9an0lkkSPPrgg4GhbcYPPLMvABsiuwhZjHSZjpehojZVSxXNAP+Vuu1Y7CVsLltVoLfCcLkNte4MLgv2VVYqjb9UcDxMht3x9TK2xnuzDxHL+zCPQ56WuVioSYhbHl6kSv4CEioMaHDqHt8DgtMLsFcpd/F6aniL5uW0ej3S7okV67R1+lt5rvUQCSU56u7m5RDGVw9TDFt297dcox6niCnAUxdZdxCjXf8txVT+N39OSrXmR8fYljvI1mw47XjT1JaOhpqUQHtGAN3lcToIa5LmFCd3FchjS3NgzuCltpS25DaH8t2W0f2i9HL4aoSxhgipns4KISpIs4v3CVXZS8="

before_install:
      - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  coverity_scan:
    project:
      name: "zerom0/CoaPP"
      description: "Build submitted via Travis CI"
    notification_email: github@martinmosler.de
    build_command:   "make -j 4"
    branch_pattern: coverity_scan
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - g++-6
      - libgtest-dev
      - cmake